<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>RSpec-1.0.8: Stubs</title>
    <link href="../../default.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="../../breadcrumbs.css" rel="stylesheet" type="text/css" media="screen"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, Stubs, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>
    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(../../images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1>RSpec 1.0.8</h1>
  </div>

  <div class="breadcrumb-menu">
    <div class="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Home</a></li>
    <li><a href="../index.html">Documentation</a></li>
    <li><a href="index.html">Mocks</a></li>
    <li class="selected"><span>Stubs</span></li>
  </ul>
</div>
<div class="menu">
  <ul>
  </ul>
</div>

  </div>

  <div id="content">
    <h2>Method Stubs</h2>


	<p>In addition to the more standard <a href="mocks.html">Mock Object framework</a>, RSpec also supports
stubbing return values to messages on any object (including Classes and mocks!). Stubs do not support any
arguments. You simply set up a return value and forget about it. If you need more control, take a
look at <a href="partial_mocks.html">partial mocking</a>.</p>


	<p>The main difference between a stub and a mock is that mocks verify interactions that you
expect, while stubs just sit there and return values.</p>


	<h3>Setting an explicit return value</h3>


	<p>This is the simplest (and recommended) approach to stubbing.</p>


<pre class="ruby"><code><span class="ident">my_instance</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">value</span><span class="punct">)</span>
<span class="constant">MyClass</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">value</span><span class="punct">)</span>
</code></pre>

	<h3>Calculating a return value</h3>


<pre class="ruby"><code><span class="ident">my_instance</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span> <span class="punct">{</span> <span class="punct">...</span> <span class="punct">}</span>
<span class="constant">MyClass</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span> <span class="punct">{</span> <span class="punct">...</span> <span class="punct">}</span>
</code></pre>

	<p>While this is possible, it is generally to be avoided. Calculating a value to return defeats
the declarative nature of stubs.</p>


	<h3>Multiple return values</h3>


<pre class="ruby"><code><span class="ident">my_instance</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">1</span><span class="punct">&quot;,</span><span class="number">2</span><span class="punct">)</span>
<span class="constant">MyClass</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">1</span><span class="punct">&quot;,</span><span class="number">2</span><span class="punct">)</span>
</code></pre>

	<p>This will return &#8220;1&#8221; the first time it is called and 2 every subsequent call. Like
calculated return values, this is a little un-stubby, but it can be a handy feature
once in a while.</p>


	<h3>Mixing stubs and mock messages</h3>


	<p>In some cases it can be helpful to stub a default return value, but set a mock expectation
for a specific set of args. For example:</p>


<pre class="ruby"><code><span class="constant">A</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="symbol">:default_value</span><span class="punct">)</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="symbol">:arg</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="symbol">:special_value</span><span class="punct">)</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">msg</span>
<span class="punct">=&gt;</span> <span class="symbol">:default_value</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">msg</span><span class="punct">(</span><span class="symbol">:any_other_arg</span><span class="punct">)</span>
<span class="punct">=&gt;</span> <span class="symbol">:default_value</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">msg</span><span class="punct">(</span><span class="symbol">:arg</span><span class="punct">)</span>
<span class="punct">=&gt;</span> <span class="symbol">:special_value</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">msg</span><span class="punct">(</span><span class="symbol">:any_other_other_arg</span><span class="punct">)</span>
<span class="punct">=&gt;</span> <span class="symbol">:default_value</span>
<span class="constant">A</span><span class="punct">.</span><span class="ident">msg</span>
<span class="punct">=&gt;</span> <span class="symbol">:default_value</span>
</code></pre>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='http://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>