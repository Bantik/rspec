<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>RSpec-1.0.8: Views</title>
    <link href="../../../default.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="../../../breadcrumbs.css" rel="stylesheet" type="text/css" media="screen"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, Views, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>
    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(../../../images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1>RSpec 1.0.8</h1>
  </div>

  <div class="breadcrumb-menu">
    <div class="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">Home</a></li>
    <li><a href="../../index.html">Documentation</a></li>
    <li><a href="../index.html">Rails</a></li>
    <li><a href="index.html">Writing</a></li>
    <li class="selected"><span>Views</span></li>
  </ul>
</div>
<div class="menu">
  <ul>
  </ul>
</div>

  </div>

  <div id="content">
    <h2>Spec::Rails &#8211; Specifying Views</h2>


	<p>View Examples live in $RAILS_ROOT/spec/views/.</p>


	<p>Spec::Rails supports the specification of views in complete isolation from their controllers.
This allows you to spec and write your views even before their controllers exist,
or before the related actions have been developed. It also means that bugs introduced
into controllers will not cause view specs to fail.</p>


	<p>As noted in the <a href="index.html">introduction</a>, these are great benefits
but they could hide bugs that exist in the interaction between a controller and its
view. We strongly recommend combining these isolated view specs with some sort of
high level <a href="integration.html">integration</a> testing.</p>


	<p>Here are some of the methods available to you, but see <a href="../../../rdoc-rails/index.html">Spec::Rails::Expectations</a> for more detail.</p>


	<h2>Conveniences</h2>


	<h3>assigns</h3>


	<p>Use assigns[:key] to set instance variables to be used in the view. We highly recommend that
you exploit the mock framework here rather than providing real model objects in order to
keep the view specs isolated from changes to your models.</p>


<pre class="ruby"><code><span class="comment"># example</span>
<span class="ident">article</span> <span class="punct">=</span> <span class="ident">mock_model</span><span class="punct">(</span><span class="constant">Article</span><span class="punct">)</span>
<span class="ident">article</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:author</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Joe</span><span class="punct">&quot;)</span>
<span class="ident">article</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:text</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">this is the text of the article</span><span class="punct">&quot;)</span>
<span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:article</span><span class="punct">]</span> <span class="punct">=</span> <span class="ident">article</span>
<span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:articles</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">[</span><span class="ident">article</span><span class="punct">]</span>

<span class="comment"># template</span>
<span class="punct">&lt;%</span> <span class="keyword">for</span> <span class="ident">article</span> <span class="keyword">in</span> <span class="attribute">@articles</span> <span class="punct">-%&gt;</span><span class="string">
&lt;!-- etc --</span><span class="punct">&gt;</span>
</code></pre>

	<h3>flash, params and session</h3>


	<p>Use flash[:key], params[:key] and session[:key] to set values in the example that can
be accessed by the view.</p>


<pre class="ruby"><code><span class="comment"># example</span>
<span class="ident">flash</span><span class="punct">[</span><span class="symbol">:notice</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Message in flash</span><span class="punct">&quot;</span>
<span class="ident">params</span><span class="punct">[</span><span class="symbol">:account_id</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">1234</span><span class="punct">&quot;</span>
<span class="ident">session</span><span class="punct">[</span><span class="symbol">:user_id</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">5678</span><span class="punct">&quot;</span>

<span class="comment"># template</span>
<span class="punct">&lt;%=</span><span class="string"> flash[:notice] %&gt;
&lt;%</span><span class="punct">=</span> <span class="ident">params</span><span class="punct">[</span><span class="symbol">:account_id</span><span class="punct">]</span> <span class="punct">%&gt;</span><span class="string">
&lt;%= session[:user_id] %</span><span class="punct">&gt;</span>
</code></pre>

	<h2>Expectations</h2>


	<p>Spec::Rails&#8217; View Examples support the following custom expectations.</p>


	<h3>template.expect_render/stub_render</h3>


	<p>This is a custom mock-like expectation that allows you to set expectations about partials and included
files that will be rendered, intercepting those calls to the #render method, while ignoring other calls
and passing them on to ActionView::Base. <code>expect_render</code> is verified at the end of the
example, while <code>stub_render</code> is not.</p>


	<p><span style="color:red;font-weight:bold;"><span class="caps">WARNING</span></span>: expect_render and stub_render, while very useful, act
differently from standard Message Expectations (a.k.a. mock expectations), which would never pass calls
through to the real object. This can be very confusing when there are failures if you&#8217;re not aware of this
fact, because some calls will be passed through while others will not. This is especially confusing when
you use <code>stub_render</code> because, as with all Method Stubs, you will get very little feedback
about what is going on.</p>


<pre class="ruby"><code><span class="ident">template</span><span class="punct">.</span><span class="ident">expect_render</span><span class="punct">(</span><span class="symbol">:partial</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">person</span><span class="punct">',</span> <span class="symbol">:object</span> <span class="punct">=&gt;</span> <span class="attribute">@person</span><span class="punct">)</span> <span class="comment">#auto-verified</span>
<span class="ident">template</span><span class="punct">.</span><span class="ident">stub_render</span><span class="punct">(</span><span class="symbol">:partial</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">person</span><span class="punct">',</span> <span class="symbol">:object</span> <span class="punct">=&gt;</span> <span class="attribute">@person</span><span class="punct">)</span>   <span class="comment">#not verified</span>
</code></pre>

	<h3>response.should have_tag</h3>


	<p>This wraps assert_select and is available in both View Examples and Controller Examples run in integration mode.</p>


<pre class="ruby"><code><span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">div</span><span class="punct">')</span> <span class="comment">#passes if any div tags appear</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">div#interesting_div</span><span class="punct">')</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">div</span><span class="punct">',</span> <span class="punct">'</span><span class="string">expected content</span><span class="punct">')</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">div</span><span class="punct">',</span> <span class="punct">/</span><span class="regex">regexp matching expected content</span><span class="punct">/)</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">ul</span><span class="punct">')</span> <span class="keyword">do</span>
  <span class="ident">with_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">list item 1</span><span class="punct">')</span>
  <span class="ident">with_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">list item 2</span><span class="punct">')</span>
  <span class="ident">with_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">list item 3</span><span class="punct">')</span>
<span class="keyword">end</span>
</code></pre>

	<p>Note that any of the hash values can be either Strings or Regexps and will be
evaluated accordingly.</p>


	<h2>Mocking and stubbing helpers</h2>


	<p>If you wish to mock or stub helper methods, this must be done on the <tt>template</tt> object:</p>


<pre class="ruby"><code><span class="ident">template</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:current_user</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">user</span><span class="punct">&quot;))</span>
</code></pre>

	<p><span style="color:red;font-weight:bold;"><span class="caps">WARNING</span>:</span> Do <span class="caps">NOT</span> use mocks on the template object for expecting partials.
Instead, use expect_render or stub_render, described above.</p>


	<h2>Sample View Examples</h2>


<pre class="ruby"><code><span class="ident">require</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/../../spec_helper</span><span class="punct">'</span>

<span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">/people/list</span><span class="punct">&quot;</span> <span class="keyword">do</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@smith</span> <span class="punct">=</span> <span class="ident">mock_model</span><span class="punct">(</span><span class="constant">Person</span><span class="punct">)</span>
    <span class="attribute">@jones</span> <span class="punct">=</span> <span class="ident">mock_model</span><span class="punct">(</span><span class="constant">Person</span><span class="punct">)</span>
    <span class="attribute">@smith</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Joe</span><span class="punct">&quot;)</span>
    <span class="attribute">@jones</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Joe</span><span class="punct">&quot;)</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:people</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">[</span><span class="attribute">@smith</span><span class="punct">,</span> <span class="attribute">@jones</span><span class="punct">]</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should display the list of people</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="attribute">@smith</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">exactly</span><span class="punct">(</span><span class="number">3</span><span class="punct">).</span><span class="ident">times</span><span class="punct">.</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Smith</span><span class="punct">&quot;)</span>
    <span class="attribute">@jones</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">exactly</span><span class="punct">(</span><span class="number">3</span><span class="punct">).</span><span class="ident">times</span><span class="punct">.</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Jones</span><span class="punct">&quot;)</span>

    <span class="ident">render</span> <span class="punct">&quot;</span><span class="string">/people/list</span><span class="punct">&quot;</span>

    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">ul</span><span class="punct">')</span> <span class="keyword">do</span>
      <span class="ident">with_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">Name: Smith</span><span class="punct">')</span>
      <span class="ident">with_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">Name: Jones</span><span class="punct">')</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should have a &lt;div&gt; tag with :id =&gt; 'a</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">render</span> <span class="punct">&quot;</span><span class="string">/people/list</span><span class="punct">&quot;</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">div#a</span><span class="punct">')</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should have a &lt;hr&gt; tag with :id =&gt; 'spacer</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">render</span> <span class="punct">&quot;</span><span class="string">/people/list</span><span class="punct">&quot;</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">hr#spacer</span><span class="punct">')</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='http://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>