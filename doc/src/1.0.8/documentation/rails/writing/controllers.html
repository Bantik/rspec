<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>RSpec-1.0.8: Controllers</title>
    <link href="../../../default.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="../../../breadcrumbs.css" rel="stylesheet" type="text/css" media="screen"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, Controllers, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>
    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(../../../images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1>RSpec 1.0.8</h1>
  </div>

  <div class="breadcrumb-menu">
    <div class="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">Home</a></li>
    <li><a href="../../index.html">Documentation</a></li>
    <li><a href="../index.html">Rails</a></li>
    <li><a href="index.html">Writing</a></li>
    <li class="selected"><span>Controllers</span></li>
  </ul>
</div>
<div class="menu">
  <ul>
  </ul>
</div>

  </div>

  <div id="content">
    <h2>Spec::Rails &#8211; Specifying Controllers</h2>


	<p>Controller Examples live in $RAILS_ROOT/spec/controllers/.</p>


	<h2>Isolation from views</h2>


	<p>Spec::Rails has the ability to specify your controllers in complete
isolation from their related views. This allows you to spec your controllers
before the views even exist, and will keep the specs from failing when there
are errors in your views.</p>


	<h2>Optional integration with views</h2>


	<p>If you prefer to integrate views (a la rails functional testing) you can by including
the keyword/commmand &#8220;integrate_views&#8221;.</p>


<pre class="ruby"><code><span class="ident">describe</span> <span class="constant">ArticlesController</span> <span class="keyword">do</span>
  <span class="ident">integrate_views</span>
  <span class="punct">...</span>
<span class="keyword">end</span>
</code></pre>

	<p>When you integrate views in the controller specs, you can use any of the
expectations that are specific to views as well. Read about <a href="views.html">View Examples</a>
to learn more.</p>


	<h2>Isolation from the database</h2>


	<p>We strongly recommend that you use RSpec&#8217;s <a href="../../mocks/index.html">mocking/stubbing framework</a>
to intercept class level calls like <code>:find</code>, <code>:create</code> and
even <code>:new</code> to introduce mock instances instead of real active_record instances.</p>


	<p>This allows you to focus your specs on the things that the controller does and not
worry about complex validations and relationships that should be described in
detail in the <a href="models.html">Model Examples</a></p>


<pre class="ruby"><code><span class="ident">account</span> <span class="punct">=</span> <span class="ident">mock_model</span><span class="punct">(</span><span class="constant">Account</span><span class="punct">)</span>
<span class="constant">Account</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(&quot;</span><span class="string">37</span><span class="punct">&quot;).</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">account</span><span class="punct">)</span>
</code></pre>

	<p>or</p>


<pre class="ruby"><code><span class="ident">account</span> <span class="punct">=</span> <span class="ident">mock_model</span><span class="punct">(</span><span class="constant">Account</span><span class="punct">)</span>
<span class="constant">Account</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">account</span><span class="punct">)</span>
</code></pre>

	<p>See <a href="../../mocks/index.html">Mocks and Stubs</a> for more information about the
built in mocking/stubbing framework.</p>


	<h2>Response Expectations</h2>


	<p>These expectations will work whether in isolation or integration mode. See <a href="../../../rdoc-rails/index.html">Spec::Rails::Expectations</a> for details.</p>


	<h3>response.should be_success</h3>


	<p>Passes if a status of 200 was returned. <span class="caps">NOTE</span> that in isolation mode, this will
always return true, so it&#8217;s not that useful &#8211; but at least your specs won&#8217;t break.</p>


<pre class="ruby"><code><span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">be_success</span>
</code></pre>

	<h3>response.should be_redirect</h3>


	<p>Passes if a status of 300-399 was returned.</p>


<pre class="ruby"><code><span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">be_redirect</span>
</code></pre>

	<h3>response.should render_template</h3>


<pre class="ruby"><code><span class="ident">get</span> <span class="punct">'</span><span class="string">some_action</span><span class="punct">'</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(&quot;</span><span class="string">path/to/template/for/action</span><span class="punct">&quot;)</span>
</code></pre>

	<h3>response.should have_text</h3>


<pre class="ruby"><code><span class="ident">get</span> <span class="punct">'</span><span class="string">some_action</span><span class="punct">'</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_text</span><span class="punct">(&quot;</span><span class="string">expected text</span><span class="punct">&quot;)</span>
</code></pre>

	<h3>response.should redirect_to</h3>


<pre class="ruby"><code><span class="ident">get</span> <span class="punct">'</span><span class="string">some_action</span><span class="punct">'</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">(</span><span class="symbol">:action</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">other_action</span><span class="punct">')</span>
</code></pre>

	<p>The following forms are supported:</p>


<pre class="ruby"><code><span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">(</span><span class="symbol">:action</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">other_action</span><span class="punct">')</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">('</span><span class="string">path/to/local/redirect</span><span class="punct">')</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">('</span><span class="string">http://test.host/some_controller/some_action</span><span class="punct">')</span>
<span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">('</span><span class="string">http://some.other.domain.com</span><span class="punct">')</span>
</code></pre>

	<h2>Rendering Expectations</h2>


	<p>In addition to response.should render_template, described above, you can state more explicit rendering
expectations using controller.expect_render and controller.stub_render. If you have an action that
renders a partial, for example:</p>


<pre class="ruby"><code><span class="ident">controller</span><span class="punct">.</span><span class="ident">expect_render</span><span class="punct">(</span><span class="symbol">:partial</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">person</span><span class="punct">',</span> <span class="symbol">:object</span> <span class="punct">=&gt;</span> <span class="attribute">@person</span><span class="punct">)</span> <span class="comment">#auto-verified</span>
<span class="ident">controller</span><span class="punct">.</span><span class="ident">stub_render</span><span class="punct">(</span><span class="symbol">:partial</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">person</span><span class="punct">',</span> <span class="symbol">:object</span> <span class="punct">=&gt;</span> <span class="attribute">@person</span><span class="punct">)</span>   <span class="comment">#not verified</span>
</code></pre>

	<p><span style="color:red;font-weight:bold;"><span class="caps">WARNING</span></span>: expect_render and stub_render, while very useful, act
differently from standard Message Expectations (a.k.a. mock expectations), which would never pass calls
through to the real object. This can be very confusing when there are failures if you&#8217;re not aware of this
fact, because some calls will be passed through while others will not. This is especially confusing when
you use <code>stub_render</code> because, as with all Method Stubs, you will get very little feedback
about what is going on.</p>


	<h3>assigns, flash and session</h3>


	<p>Use these to access assigns, flash and session.</p>


<pre class="ruby"><code><span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:key</span><span class="punct">]</span>
<span class="ident">flash</span><span class="punct">[</span><span class="symbol">:key</span><span class="punct">]</span>
<span class="ident">session</span><span class="punct">[</span><span class="symbol">:key</span><span class="punct">]</span>
</code></pre>

	<h2>Routing Expectations</h2>


	<p>Specify the paths generated by custom routes.</p>


<pre class="ruby"><code><span class="ident">route_for</span><span class="punct">(</span><span class="symbol">:controller</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">hello</span><span class="punct">&quot;,</span> <span class="symbol">:action</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">world</span><span class="punct">&quot;).</span><span class="ident">should</span> <span class="punct">==</span> <span class="punct">&quot;</span><span class="string">/hello/world</span><span class="punct">&quot;</span>
</code></pre>

	<h2>Sample Controller Example</h2>


<pre class="ruby"><code><span class="comment"># The comments below are here for educational purposes only.</span>
<span class="comment"># They are not an endorsement of comments in your spec!</span>

<span class="ident">require</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/../spec_helper</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">ostruct</span><span class="punct">'</span>

<span class="ident">describe</span> <span class="constant">PeopleController</span> <span class="keyword">do</span>
  <span class="comment"># If you pass the controller to #describe, you don't need to declare the controller name</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@person</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">person</span><span class="punct">&quot;)</span>

    <span class="comment"># Generally, prefer stub! over should_receive in setup.</span>
    <span class="attribute">@person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:new_record?</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="constant">false</span><span class="punct">)</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:new</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should create a new, unsaved person on GET to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="comment"># Using should_receive here overrides the stub in setup. Even</span>
    <span class="comment"># though it is the same as the stub, using should_receive sets</span>
    <span class="comment"># an expectation that  will be verified. It also helps to</span>
    <span class="comment"># better express the intent of this example.</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:new</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">create</span><span class="punct">'</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should assign new person to template on GET to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">create</span><span class="punct">'</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:person</span><span class="punct">].</span><span class="ident">should</span> <span class="ident">equal</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should render 'people/create' on GET to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">create</span><span class="punct">'</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(</span><span class="symbol">:create</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should tell the Person model to create a new person on POST to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:create</span><span class="punct">).</span><span class="ident">with</span><span class="punct">({&quot;</span><span class="string">name</span><span class="punct">&quot;</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>

    <span class="ident">post</span> <span class="punct">'</span><span class="string">create</span><span class="punct">',</span> <span class="punct">{</span><span class="symbol">:person</span> <span class="punct">=&gt;</span> <span class="punct">{</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}}</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">with a valid person should redirect to index on successful POST to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="attribute">@person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:new_record?</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="constant">false</span><span class="punct">)</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:create</span><span class="punct">).</span><span class="ident">with</span><span class="punct">({&quot;</span><span class="string">name</span><span class="punct">&quot;</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>

    <span class="ident">post</span> <span class="punct">'</span><span class="string">create</span><span class="punct">',</span> <span class="punct">{</span><span class="symbol">:person</span> <span class="punct">=&gt;</span> <span class="punct">{</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}}</span>

    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">redirect_to</span><span class="punct">(</span><span class="symbol">:action</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">index</span><span class="punct">')</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">with a valid person should re-render 'people/create' on failed POST to create</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="attribute">@person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:new_record?</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="constant">true</span><span class="punct">)</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:create</span><span class="punct">).</span><span class="ident">with</span><span class="punct">({&quot;</span><span class="string">name</span><span class="punct">&quot;</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>

    <span class="ident">post</span> <span class="punct">'</span><span class="string">create</span><span class="punct">',</span> <span class="punct">{</span><span class="symbol">:person</span> <span class="punct">=&gt;</span> <span class="punct">{</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'}}</span>

    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(&quot;</span><span class="string">people/create</span><span class="punct">&quot;)</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should_not</span> <span class="ident">be_redirect</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:person</span><span class="punct">].</span><span class="ident">should</span> <span class="punct">==</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span><span class="punct">({</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Aslak</span><span class="punct">'})</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">When requesting /people with controller isolated from views</span><span class="punct">&quot;</span> <span class="keyword">do</span>
  <span class="comment"># If you do not pass the controller to #describe, you need to declare the controller name</span>
  <span class="ident">controller_name</span> <span class="symbol">:people</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@mock_person</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">person</span><span class="punct">&quot;)</span>
    <span class="attribute">@mock_person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Joe</span><span class="punct">&quot;)</span>
    <span class="attribute">@people</span> <span class="punct">=</span> <span class="punct">[</span><span class="attribute">@mock_person</span><span class="punct">]</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@people</span><span class="punct">)</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">index</span><span class="punct">'</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">the response should render 'list'</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(</span><span class="symbol">:list</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should find all people on GET to index</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:people</span><span class="punct">].</span><span class="ident">should</span> <span class="ident">equal</span><span class="punct">(</span><span class="attribute">@people</span><span class="punct">)</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">When requesting /people with views integrated</span><span class="punct">&quot;</span> <span class="keyword">do</span>
  <span class="ident">controller_name</span> <span class="symbol">:people</span>
  <span class="ident">integrate_views</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@mock_person</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">person</span><span class="punct">&quot;)</span>
    <span class="attribute">@mock_person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:name</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(&quot;</span><span class="string">Joe</span><span class="punct">&quot;)</span>
    <span class="attribute">@people</span> <span class="punct">=</span> <span class="punct">[</span><span class="attribute">@mock_person</span><span class="punct">]</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@people</span><span class="punct">)</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">index</span><span class="punct">'</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">the response should render 'list'</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(</span><span class="symbol">:list</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">the response should not render 'index'</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">lambda</span> <span class="punct">{</span>
      <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(</span><span class="symbol">:index</span><span class="punct">)</span>
    <span class="punct">}.</span><span class="ident">should</span> <span class="ident">raise_error</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should find all people on GET to index</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">be_success</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:people</span><span class="punct">].</span><span class="ident">should</span> <span class="ident">equal</span><span class="punct">(</span><span class="attribute">@people</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should list pets on GET to show</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">person</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">person</span><span class="punct">&quot;)</span>
    <span class="ident">person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:pets</span><span class="punct">).</span><span class="ident">and_return</span><span class="punct">([</span><span class="constant">OpenStruct</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Hannibal</span><span class="punct">'),</span> <span class="constant">OpenStruct</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="symbol">:name</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Rufus</span><span class="punct">')])</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">with</span><span class="punct">('</span><span class="string">4</span><span class="punct">').</span><span class="ident">and_return</span><span class="punct">(</span><span class="ident">person</span><span class="punct">)</span>

    <span class="ident">get</span> <span class="punct">'</span><span class="string">show</span><span class="punct">',</span> <span class="symbol">:id</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">4</span><span class="punct">'</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">Hannibal</span><span class="punct">')</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">have_tag</span><span class="punct">('</span><span class="string">li</span><span class="punct">',</span> <span class="punct">'</span><span class="string">Rufus</span><span class="punct">')</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">/people/show/3</span><span class="punct">&quot;</span> <span class="keyword">do</span>
  <span class="ident">controller_name</span> <span class="symbol">:people</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@person</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">person</span><span class="punct">&quot;)</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should get person with id =&gt; 3 from model</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(&quot;</span><span class="string">3</span><span class="punct">&quot;).</span><span class="ident">and_return</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>

    <span class="ident">get</span> <span class="punct">'</span><span class="string">show</span><span class="punct">',</span> <span class="symbol">:id</span> <span class="punct">=&gt;</span> <span class="number">3</span>

    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:person</span><span class="punct">].</span><span class="ident">should</span> <span class="ident">equal</span><span class="punct">(</span><span class="attribute">@person</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">Given an attempt to show a person that doesn't exist</span><span class="punct">&quot;</span> <span class="keyword">do</span>
  <span class="ident">controller_name</span> <span class="symbol">:people</span>

  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="constant">Person</span><span class="punct">.</span><span class="ident">stub!</span><span class="punct">(</span><span class="symbol">:find</span><span class="punct">)</span>
    <span class="ident">get</span> <span class="punct">'</span><span class="string">show</span><span class="punct">',</span> <span class="symbol">:id</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">broken</span><span class="punct">'</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should not assign a person</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">assigns</span><span class="punct">[</span><span class="symbol">:person</span><span class="punct">].</span><span class="ident">should</span> <span class="punct">==</span> <span class="constant">nil</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should render 404 file</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">render_template</span><span class="punct">(&quot;</span><span class="string"><span class="expr">#{RAILS_ROOT}</span>/public/404.html</span><span class="punct">&quot;)</span>
    <span class="ident">response</span><span class="punct">.</span><span class="ident">headers</span><span class="punct">[&quot;</span><span class="string">Status</span><span class="punct">&quot;].</span><span class="ident">should</span> <span class="punct">==</span> <span class="punct">&quot;</span><span class="string">404 Not Found</span><span class="punct">&quot;</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='http://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>