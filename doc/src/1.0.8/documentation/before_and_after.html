<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>RSpec-1.0.8: Before and After</title>
    <link href="../default.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="../breadcrumbs.css" rel="stylesheet" type="text/css" media="screen"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, Before and After, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>
    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(../images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1>RSpec 1.0.8</h1>
  </div>

  <div class="breadcrumb-menu">
    <div class="breadcrumbs">
  <ul>
    <li><a href="../index.html">Home</a></li>
    <li><a href="index.html">Documentation</a></li>
    <li class="selected"><span>Before and After</span></li>
  </ul>
</div>
<div class="menu">
  <ul>
  </ul>
</div>

  </div>

  <div id="content">
    <h2>Before and After</h2>


	<h3>before(:each) and after(:each)</h3>


	<p>RSpec provides methods that let you set up and tear down state before(:each)
and after(:each) example.</p>


<pre class="ruby"><code><span class="ident">describe</span> <span class="constant">Account</span> <span class="keyword">do</span>
  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@account</span> <span class="punct">=</span> <span class="constant">Account</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should have a balance of $0</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="attribute">@account</span><span class="punct">.</span><span class="ident">balance</span><span class="punct">.</span><span class="ident">should</span> <span class="punct">==</span> <span class="constant">Money</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="number">0</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="ident">after</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="comment"># this is here as an example, but is not really</span>
    <span class="comment"># necessary. Since each example is run in its</span>
    <span class="comment"># own object, instance variables go out of scope</span>
    <span class="comment"># between each example.</span>
    <span class="attribute">@account</span> <span class="punct">=</span> <span class="constant">nil</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>

	<p>Note that after(:each) is rarely needed, and should only really be used when concerned
that some state might be leaking into your other examples.</p>


	<h3>before(:all) and after(:all)</h3>


	<p>For expensive operations, like opening browsers using Spec::Ui, RSpec also allows
you to set up and tear down state before(:all) and after(:all) examples in any
given behaviour.</p>


<pre class="ruby"><code><span class="ident">describe</span> <span class="punct">&quot;</span><span class="string">Search page</span><span class="punct">&quot;</span> <span class="keyword">do</span>
  <span class="ident">before</span><span class="punct">(</span><span class="symbol">:all</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@browser</span> <span class="punct">=</span> <span class="constant">Watir</span><span class="punct">::</span><span class="constant">Browser</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>

  <span class="ident">it</span> <span class="punct">&quot;</span><span class="string">should find all contacts</span><span class="punct">&quot;</span> <span class="keyword">do</span>
    <span class="punct">...</span>
  <span class="keyword">end</span>

  <span class="ident">after</span><span class="punct">(</span><span class="symbol">:all</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="attribute">@browser</span><span class="punct">.</span><span class="ident">kill!</span> <span class="keyword">rescue</span> <span class="constant">nil</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>

	<h3>Global after and before blocks</h3>


	<p>Sometimes you have some generic code you want to run before or after every single one of your
examples. Such global before and after blocks can be defined in the RSpec configuration, which
typically lives in a spec_helper.rb file that is required from other spec files. Example:</p>


<pre class="ruby"><code><span class="constant">Spec</span><span class="punct">::</span><span class="constant">Runner</span><span class="punct">.</span><span class="ident">configure</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">config</span><span class="punct">|</span>
  <span class="ident">config</span><span class="punct">.</span><span class="ident">before</span><span class="punct">(</span><span class="symbol">:all</span><span class="punct">)</span> <span class="punct">{}</span>
  <span class="ident">config</span><span class="punct">.</span><span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="punct">{}</span>
  <span class="ident">config</span><span class="punct">.</span><span class="ident">after</span><span class="punct">(</span><span class="symbol">:all</span><span class="punct">)</span> <span class="punct">{}</span>
  <span class="ident">config</span><span class="punct">.</span><span class="ident">after</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">)</span> <span class="punct">{}</span>
<span class="keyword">end</span>
</code></pre>

	<p>Global before blocks get run before local ones. Global after blocks get run after local ones.</p>


	<p>You can also specify that a before or after block should only be weaved into certain behaviours,
in a similar way to how global includes are declared:</p>


<pre class="ruby"><code><span class="constant">Spec</span><span class="punct">::</span><span class="constant">Runner</span><span class="punct">.</span><span class="ident">configure</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">config</span><span class="punct">|</span>
  <span class="ident">config</span><span class="punct">.</span><span class="ident">before</span><span class="punct">(</span><span class="symbol">:each</span><span class="punct">,</span> <span class="symbol">:behaviour_type</span> <span class="punct">=&gt;</span> <span class="symbol">:controller</span><span class="punct">)</span> <span class="keyword">do</span>
    <span class="ident">login_aslak</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre>

	<h3>When before and after raise errors</h3>


	<p>If a before block raises an error, none of the following before blocks (if any) or the example itself will get run.
If an after block raises an error, the remaining ones will still be run.</p>


	<h3><span style="font-weight:bold; color:red;"><span class="caps">WARNING ABOUT</span> before(:all) and after(:all)</span></h3>


	<p>It is very tempting to use before(:all) and after(:all) for situations in which it
is not appropriate. before(:all) shares some (not all) state across multiple examples. This means
that the examples become bound together, which is an absolute no-no in testing. You
should really only ever use before(:all) to set up things that are global collaborators
but not the things that you are describing in the examples.</p>


	<p>The most common cases of abuse are database access and/or fixture setup. Every example
that accesses the database should start with a clean slate, otherwise the examples become
brittle and start to lose their value with false negatives and, worse, false positives.</p>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='http://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>