$LOAD_PATH.unshift(File.expand_path(File.dirname(__FILE__) + "/../lib"))
require 'spec'

# == Warning: This is VERY PRELIMINARY AND CURRENTLY NOT TESTED IN ANY WAY BUT MANUALLY
#
# == Single Plain-Text Story Teller
#
#   To run a plain text story, you need two files in the same directory named as follows
#   (assuming a story named "account_withdrawal"):
#
#     account_withdrawal
#     account_withdrawal.rb
#
#   The first file should have the story in it. The second file should set up the matchers
#   necessary.
#
# == Example
#
#   See rspec/examples/story/addition and rspec/examples/story/addition.rb
#
#   Tell that story as follows (from the rspec directory):
#
#     ruby bin/tell examples/story/addition
#

factory = Spec::Story::Runner::StoryPartFactory.new $rspec_story_step_matchers
parser = Spec::Story::Runner::StoryParser.new factory

story_file = ARGV.first
story_support_file = "#{story_file}.rb"
require story_support_file

story_text = File.read(story_file)
parser.parse story_text.split("\n")

story_runner = Spec::Story::Runner.story_runner
factory.stories.each { |s| story_runner.instance_eval &s }
