<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>RSpec-1.0.8: Mock Objects</title>
    <link href="../../default.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="../../breadcrumbs.css" rel="stylesheet" type="text/css" media="screen"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, Mock Objects, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>
    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(../../images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1>RSpec 1.0.8</h1>
  </div>

  <div class="breadcrumb-menu">
    <div class="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Home</a></li>
    <li><a href="../index.html">Documentation</a></li>
    <li><a href="index.html">Mocks</a></li>
    <li class="selected"><span>Mock Objects</span></li>
  </ul>
</div>
<div class="menu">
  <ul>
  </ul>
</div>

  </div>

  <div id="content">
    <h2>Mock Objects</h2>


	<p>This page describes RSpec&#8217;s built-in mocking <span class="caps">API</span>.</p>


	<h3>Creating a mock</h3>


<pre class="ruby"><code><span class="ident">my_mock</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&lt;</span><span class="ident">name</span><span class="punct">&gt;)</span>
</code></pre>

	<p>This creates a new mock with the given <code>name</code> (a string) and registers it. 
When the specification finishes, all registered mocks are verified.</p>


<pre class="ruby"><code><span class="ident">my_mock</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&lt;</span><span class="ident">name</span><span class="punct">&gt;,</span> <span class="punct">&lt;</span><span class="ident">options</span><span class="punct">&gt;)</span>
</code></pre>

	<p>As above, but allows you to specific options to tweak the mock&#8217;s behaviour.
The <code>options</code> argument is a hash. Currently the only supported option
is <code>:null_object</code>. Setting this to true instructs the mock to ignore 
(quietly consume) any messages it hasn&#8217;t been told to expect &#8211; and return itself.  i.e.</p>


<pre class="ruby"><code><span class="ident">my_mock</span> <span class="punct">=</span> <span class="ident">mock</span><span class="punct">(&quot;</span><span class="string">blah</span><span class="punct">&quot;,</span> <span class="symbol">:null_object</span> <span class="punct">=&gt;</span> <span class="constant">true</span><span class="punct">)</span>
</code></pre>

	<h3>Expecting Messages</h3>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(&lt;</span><span class="ident">message</span><span class="punct">&gt;)</span>
</code></pre>

	<p>The <code>message</code> argument is a symbol that is the name of a message 
that you want the mock to expect.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_not_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">)</span>
</code></pre>

	<p>An exception is raised if the message is ever received.
This is equivalent to not specifying the reception of :msg,
but it&#8217;s more declarative and useful for humans.</p>


	<h3>Expecting Arguments</h3>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(&lt;</span><span class="ident">args</span><span class="punct">&gt;)</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">with</span><span class="punct">(&lt;</span><span class="ident">args</span><span class="punct">&gt;)</span>
</code></pre>

	<p>for example:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="number">1</span><span class="punct">,</span> <span class="number">2</span><span class="punct">,</span> <span class="number">3</span><span class="punct">)</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">with</span><span class="punct">(</span><span class="number">1</span><span class="punct">,</span> <span class="number">2</span><span class="punct">,</span> <span class="number">3</span><span class="punct">)</span>
</code></pre>

	<p>The <code>args</code> argument is a series of arguments (e.g. 1, 2, 3) that are 
expected to be passed as arguments to the associated message.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="symbol">:no_args</span><span class="punct">)</span>
</code></pre>

	<p>The message (<code>msg</code>) is expected to be passed no arguments.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="symbol">:any_args</span><span class="punct">)</span>
</code></pre>

	<p>Any arguments (and any number of arguments) are to be accepted. This includes 
cases where no arguments are provided. <strong>This is the default when no <code>with()</code> 
clause is specified.</strong>  Even so, sometimes you want to be explicit about it.</p>


	<h3>Argument Constraints</h3>


	<p>Constraints can be placed on individual arguments which are looser than value 
equivalence (as above).</p>


	<h4>:anything</h4>


	<p>accepts any value for this argument, e.g.:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="number">1</span><span class="punct">,</span> <span class="symbol">:anything</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">A</span><span class="punct">&quot;)</span>
</code></pre>

	<h4>:numeric</h4>


	<p>accepts any numeric value for this argument, e.g.:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="ident">a</span><span class="punct">,</span> <span class="symbol">:numeric</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">b</span><span class="punct">&quot;)</span>
</code></pre>

	<h4>:boolean</h4>


	<p>accepts a boolean value for this argument, e.g.:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="ident">a</span><span class="punct">,</span> <span class="symbol">:boolean</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">b</span><span class="punct">&quot;)</span>
</code></pre>

	<h4>:string</h4>


	<p>accepts any string for this argument, e.g.:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="ident">a</span><span class="punct">,</span> <span class="symbol">:string</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">b</span><span class="punct">&quot;)</span>
</code></pre>

	<h4>duck_type(message(s))</h4>


	<p>accepts any object that responds to the prescribed message(s), e.g.:</p>


<pre class="ruby"><code><span class="comment">#accepts a Fixnum for the second arg</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="ident">a</span><span class="punct">,</span> <span class="ident">duck_type</span><span class="punct">(</span><span class="symbol">:abs</span><span class="punct">,</span> <span class="symbol">:div</span><span class="punct">),</span> <span class="punct">&quot;</span><span class="string">b</span><span class="punct">&quot;)</span> 
</code></pre>

	<h4>/regular expressions/</h4>


	<p>matches a String against a regular expression. If a regular expression is submitted, compares the two expressions for equality</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(/</span><span class="regex">bcd</span><span class="punct">/)</span>

<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">msg</span> <span class="punct">&quot;</span><span class="string">abcde</span><span class="punct">&quot;</span> <span class="comment">#passes </span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">msg</span> <span class="punct">/</span><span class="ident">bcd</span><span class="punct">/</span> <span class="comment">#passes </span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">msg</span> <span class="punct">&quot;</span><span class="string">def</span><span class="punct">&quot;</span> <span class="comment">#fails</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">msg</span> <span class="punct">/</span><span class="ident">bcde</span><span class="punct">/</span> <span class="comment">#fails</span>
</code></pre>

	<h3>Receive Counts</h3>


	<p>The implicit expectation is that the message passed to <code>should_receive</code> will
be called once. You can make the expected counts explicit using the following:</p>


	<h4>Precise Counts</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span>
</code></pre>

	<p>An exception is raised if the message is never received, or it is received more than once.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">twice</span>
</code></pre>

	<p>An exception is raised if the message is received anything but two times.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">exactly</span><span class="punct">(</span><span class="ident">n</span><span class="punct">).</span><span class="ident">times</span>
</code></pre>

	<p>An exception is raised if the message is received anything but <code>n</code> times.</p>


	<h4>Relative Counts &#8211; at_least</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_least</span><span class="punct">(</span><span class="symbol">:once</span><span class="punct">)</span>
</code></pre>

	<p>An exception is raised if the message is never received.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_least</span><span class="punct">(</span><span class="symbol">:twice</span><span class="punct">)</span>
</code></pre>

	<p>An exception is raised if the message is never received or is received only once.</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_least</span><span class="punct">(</span><span class="ident">n</span><span class="punct">).</span><span class="ident">times</span>
</code></pre>

	<p>An exception is raised if the message is received fewer than <code>n</code> times.</p>


	<h4>Relative Counts &#8211; at_most</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_most</span><span class="punct">(</span><span class="symbol">:once</span><span class="punct">)</span>
</code></pre>

	<p>An exception is raised if the message is received more than once (does not raise if message is never receieved).</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_most</span><span class="punct">(</span><span class="symbol">:twice</span><span class="punct">)</span>
</code></pre>

	<p>An exception is raised if the message is received more than twice (does not raise if message is never receieved).</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">at_most</span><span class="punct">(</span><span class="ident">n</span><span class="punct">).</span><span class="ident">times</span>
</code></pre>

	<p>An exception is raised if the message is received more than <code>n</code> times (does not raise if message is never receieved).</p>


	<h4>Explicitly Imprecise Counts</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">any_number_of_times</span>
</code></pre>

	<p>The message can be received 0 or more times.</p>


	<h3>Return Values</h3>


	<h4>Single return value</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">and_return</span><span class="punct">(&lt;</span><span class="ident">value</span><span class="punct">&gt;)</span>
</code></pre>

	<p>Each time the expected message is received, <code>value</code> will be returned as the result.</p>


	<h4>Consecutive return values</h4>


<pre class="ruby"><code><span class="ident">and_return</span><span class="punct">(&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="number">1</span><span class="punct">&gt;,</span> <span class="punct">&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="number">2</span><span class="punct">&gt;,</span> <span class="punct">...,</span> <span class="punct">&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="ident">n</span><span class="punct">&gt;)</span>
</code></pre>

	<p>When the expected message is received, <code>value-i</code> will be returned as
the result for the ith reception of the message. After the message has been
received <code>i</code> times, <code>value-n</code> is returned for all
subsequent receives.</p>


	<h4>Computed return value</h4>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">and_return</span> <span class="punct">{...}</span> 
</code></pre>

	<p>When the expected message is received, the result of evaluating the supplied
block will be returned as the result. The block is passed any arguments passed
as arguments of the message. This capability can be used to compute return 
values based on the arguments.  For example:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">with</span><span class="punct">(</span><span class="symbol">:numeric</span><span class="punct">,</span> <span class="symbol">:numeric</span><span class="punct">)</span> <span class="ident">once</span><span class="punct">.</span><span class="ident">and_return</span> <span class="punct">{|</span><span class="ident">a</span><span class="punct">,</span> <span class="ident">b</span><span class="punct">|</span> <span class="ident">a</span> <span class="punct">+</span> <span class="ident">b</span><span class="punct">}</span>
</code></pre>

	<h3>Raising and Throwing</h3>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">and_raise</span><span class="punct">(&lt;</span><span class="ident">exception</span><span class="punct">&gt;)</span>
</code></pre>

	<p>Tells the mock to raise an exception instead of returning a value.
&lt;exception&gt; may be any Exception class, an instance of
any Exception class, or a String (in which case a RuntimeError will be raised
with that String as its message).</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">and_throw</span><span class="punct">(&lt;</span><span class="ident">symbol</span><span class="punct">&gt;)</span> 
</code></pre>

	<p>Tells the mock to throw a symbol instead of returning a value.</p>


	<h3>Yielding</h3>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">and_yield</span><span class="punct">([&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="number">1</span><span class="punct">&gt;,</span> <span class="punct">&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="number">2</span><span class="punct">&gt;,</span> <span class="punct">...,</span> <span class="punct">&lt;</span><span class="ident">value</span><span class="punct">-</span><span class="ident">n</span><span class="punct">&gt;])</span>
</code></pre>

	<p>When the expected message is received, the mock will yield the values to the passed block.</p>


	<h3>Ordering</h3>


	<p>There are times when you want to specify the order of messages sent to a mock.
It shouldn&#8217;t be the case very often, but it can be handy at times.</p>


	<p>Labeling expectations as being ordered is done by the <code>ordered</code> call:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:flip</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">ordered</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:flop</span><span class="punct">).</span><span class="ident">once</span><span class="punct">.</span><span class="ident">ordered</span>
</code></pre>

	<p>If the send of <code>flop</code> is seen before <code>flip</code> the specification will fail.</p>


	<p>Of course, chains of ordered expectations can be set up:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:one</span><span class="punct">).</span><span class="ident">ordered</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:two</span><span class="punct">).</span><span class="ident">ordered</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:three</span><span class="punct">).</span><span class="ident">ordered</span>
</code></pre>

	<p>The expected order is the order in which the expectations are declared.</p>


	<p>Order-independent expectations can be set anywhere in the expectation sequence, in any order.  
Only the order of expectations tagged with the <code>ordered</code> call is significant.  
Likewise, calls to order-independent methods can be made in any order, even interspersed with 
calls to order-dependent methods.  For example:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:zero</span><span class="punct">)</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:one</span><span class="punct">).</span><span class="ident">ordered</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:two</span><span class="punct">).</span><span class="ident">ordered</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:one_and_a_half</span><span class="punct">)</span>

<span class="comment"># This will pass:</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">one</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">one_and_a_half</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">zero</span>
<span class="ident">my_mock</span><span class="punct">.</span><span class="ident">two</span>
</code></pre>

	<h3>Arbitrary Handling of Received Messages</h3>


	<p>You can supply a block to a message expectation. When the message is received
by the mock, the block is passed any arguments and evaluated. The result is
the return value of the block. For example:</p>


<pre class="ruby"><code><span class="ident">my_mock</span><span class="punct">.</span><span class="ident">should_receive</span><span class="punct">(</span><span class="symbol">:msg</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">a</span><span class="punct">,</span> <span class="ident">b</span><span class="punct">|</span> 
  <span class="ident">a</span><span class="punct">.</span><span class="ident">should</span> <span class="ident">be_true</span>
  <span class="ident">b</span><span class="punct">.</span><span class="ident">should_not</span> <span class="ident">include</span><span class="punct">('</span><span class="string">mice</span><span class="punct">')</span>
  <span class="punct">&quot;</span><span class="string">Chunky bacon!</span><span class="punct">&quot;</span>
<span class="punct">}</span>
</code></pre>

	<p>This allows arbitrary argument validation and result computation.  It&#8217;s handy and kind of cool to be able to 
do this, but it is advised to not use this form in most situations.  Mocks should not be functional.  
They should be completely declarative.  That said, it&#8217;s sometimes useful to give them some minimal behaviour.</p>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='http://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>